2025-11-21 22:25:47,968 - INFO - Logging initialized. Log file: runs/run_29/training.log
2025-11-21 22:25:47,969 - INFO - Experiment directory: runs/run_29
2025-11-21 22:25:48,156 - INFO - Setting random seeds for reproducibility (seed: 42)...
2025-11-21 22:25:48,175 - INFO - Random seeds set to 42 (deterministic=False)
2025-11-21 22:25:48,176 - INFO - Setting up device...
2025-11-21 22:25:48,177 - INFO - Using device: cuda
2025-11-21 22:25:48,178 - INFO - Using device: cuda
2025-11-21 22:25:48,178 - INFO - Training configuration: epochs=3, warmup=2, lr=0.001
2025-11-21 22:25:48,179 - INFO - Using pretrained model: swin_tiny_patch4_window7_224
2025-11-21 22:25:48,179 - INFO - Model architecture: Swin-Tiny
2025-11-21 22:25:48,180 - INFO - Model config: embed_dim=96, depths=[2, 2, 6, 2], num_heads=[3, 6, 12, 24]
2025-11-21 22:25:48,181 - INFO - Image size: 224x224, patch_size: 4x4
2025-11-21 22:25:48,182 - INFO - Loading dataset...
2025-11-21 22:25:51,668 - INFO - Dataset loaded: train=1303, val=261, test=313 batches
2025-11-21 22:25:51,669 - INFO - Initializing reference model...
2025-11-21 22:25:51,669 - INFO - Loading TIMM model: swin_tiny_patch4_window7_224 with pretrained weights
2025-11-21 22:25:52,922 - INFO - Loading pretrained weights from Hugging Face hub (timm/swin_tiny_patch4_window7_224.ms_in1k)
2025-11-21 22:25:53,283 - INFO - HTTP Request: HEAD https://huggingface.co/timm/swin_tiny_patch4_window7_224.ms_in1k/resolve/main/model.safetensors "HTTP/1.1 302 Found"
2025-11-21 22:25:53,312 - INFO - [timm/swin_tiny_patch4_window7_224.ms_in1k] Safe alternative available for 'pytorch_model.bin' (as 'model.safetensors'). Loading weights using safetensors.
2025-11-21 22:25:53,589 - INFO - Successfully loaded swin_tiny_patch4_window7_224 from TIMM
2025-11-21 22:25:53,590 - INFO - Encoder loaded: 768 output features
2025-11-21 22:25:53,592 - INFO - Created classification head: 768 -> 100 classes
2025-11-21 22:25:53,594 - INFO - Reference model created. Trainable params (head only): 78,436
2025-11-21 22:25:53,831 - INFO - Detected Swin Transformer architecture
2025-11-21 22:25:53,832 - INFO - Extracting model size from TIMM model name...
2025-11-21 22:25:53,832 - INFO - Detected model size: tiny
2025-11-21 22:25:53,833 - INFO - Will create custom model with: {'embed_dim': 96, 'depths': [2, 2, 6, 2], 'num_heads': [3, 6, 12, 24]}
2025-11-21 22:25:53,834 - INFO - Initializing custom Swin model (size: tiny)...
2025-11-21 22:25:53,835 - ERROR - Failed to create custom model (size: tiny): cannot access local variable 'preset' where it is not associated with a value
2025-11-21 22:25:53,836 - ERROR - Experiment failed with error: Custom model creation failed: cannot access local variable 'preset' where it is not associated with a value
2025-11-21 22:25:53,837 - ERROR - Full traceback:
Traceback (most recent call last):
  File "/home/pml04/swin_transformer/Machine-Learning-Project/main.py", line 536, in create_custom_model
    f"Custom model will match architecture: embed_dim={preset['embed_dim']}, depths={preset['depths']}, num_heads={preset['num_heads']}"
                                                       ^^^^^^
UnboundLocalError: cannot access local variable 'preset' where it is not associated with a value

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/pml04/swin_transformer/Machine-Learning-Project/main.py", line 801, in main
    custom_model = create_custom_model(reference_model, model_size, device)
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/pml04/swin_transformer/Machine-Learning-Project/main.py", line 618, in create_custom_model
    raise RuntimeError(f"Custom model creation failed: {e}") from e
RuntimeError: Custom model creation failed: cannot access local variable 'preset' where it is not associated with a value
