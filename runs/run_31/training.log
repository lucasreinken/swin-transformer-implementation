2025-11-21 22:27:43,636 - INFO - Logging initialized. Log file: runs/run_31/training.log
2025-11-21 22:27:43,638 - INFO - Experiment directory: runs/run_31
2025-11-21 22:27:43,825 - INFO - Setting random seeds for reproducibility (seed: 42)...
2025-11-21 22:27:43,836 - INFO - Random seeds set to 42 (deterministic=False)
2025-11-21 22:27:43,837 - INFO - Setting up device...
2025-11-21 22:27:43,838 - INFO - Using device: cuda
2025-11-21 22:27:43,839 - INFO - Using device: cuda
2025-11-21 22:27:43,840 - INFO - Training configuration: epochs=3, warmup=2, lr=0.001
2025-11-21 22:27:43,841 - INFO - Using pretrained model: swin_tiny_patch4_window7_224
2025-11-21 22:27:43,842 - INFO - Model architecture: Swin-Tiny
2025-11-21 22:27:43,843 - INFO - Model config: embed_dim=96, depths=[2, 2, 6, 2], num_heads=[3, 6, 12, 24]
2025-11-21 22:27:43,844 - INFO - Image size: 224x224, patch_size: 4x4
2025-11-21 22:27:43,845 - INFO - Loading dataset...
2025-11-21 22:27:46,285 - INFO - Dataset loaded: train=1303, val=261, test=313 batches
2025-11-21 22:27:46,287 - INFO - Initializing reference model...
2025-11-21 22:27:46,288 - INFO - Loading TIMM model: swin_tiny_patch4_window7_224 with pretrained weights
2025-11-21 22:27:46,795 - INFO - Loading pretrained weights from Hugging Face hub (timm/swin_tiny_patch4_window7_224.ms_in1k)
2025-11-21 22:27:47,016 - INFO - HTTP Request: HEAD https://huggingface.co/timm/swin_tiny_patch4_window7_224.ms_in1k/resolve/main/model.safetensors "HTTP/1.1 302 Found"
2025-11-21 22:27:47,034 - INFO - [timm/swin_tiny_patch4_window7_224.ms_in1k] Safe alternative available for 'pytorch_model.bin' (as 'model.safetensors'). Loading weights using safetensors.
2025-11-21 22:27:47,205 - INFO - Successfully loaded swin_tiny_patch4_window7_224 from TIMM
2025-11-21 22:27:47,207 - INFO - Encoder loaded: 768 output features
2025-11-21 22:27:47,208 - INFO - Created classification head: 768 -> 100 classes
2025-11-21 22:27:47,211 - INFO - Reference model created. Trainable params (head only): 78,436
2025-11-21 22:27:47,451 - INFO - Detected Swin Transformer architecture
2025-11-21 22:27:47,453 - INFO - Extracting model size from TIMM model name...
2025-11-21 22:27:47,454 - INFO - Detected model size: tiny
2025-11-21 22:27:47,456 - INFO - Will create custom model with: {'embed_dim': 96, 'depths': [2, 2, 6, 2], 'num_heads': [3, 6, 12, 24]}
2025-11-21 22:27:47,457 - INFO - Initializing custom Swin model (size: tiny)...
2025-11-21 22:27:47,459 - INFO - Custom model will match architecture: embed_dim=96, depths=[2, 2, 6, 2], num_heads=[3, 6, 12, 24]
2025-11-21 22:27:47,804 - INFO - Transferring weights from reference to custom encoder...
2025-11-21 22:27:47,805 - INFO - Weight transfer: SwinTransformer -> SwinTransformerModel
2025-11-21 22:27:47,821 - INFO - Weight transfer: 169 layers transferred.
2025-11-21 22:27:47,841 - INFO - Weight transfer completed: {'transferred': 169, 'missing': 0, 'size_mismatches': 0}
2025-11-21 22:27:47,842 - INFO - ✓ All expected weights transferred successfully
2025-11-21 22:27:47,844 - INFO - Custom model created. Trainable params (head only): 78,436
2025-11-21 22:27:47,847 - INFO - Starting reference model training...
2025-11-21 22:27:47,848 - INFO - Starting training...
2025-11-21 22:29:57,097 - INFO - Epoch 1/3: LR: 0.000550
2025-11-21 22:29:57,099 - INFO - Epoch 1/3: Train Loss: 3.5903, Val Loss: 2.5830, Val Acc: 60.75%
2025-11-21 22:32:04,512 - INFO - Epoch 2/3: LR: 0.001000
2025-11-21 22:32:04,524 - INFO - Epoch 2/3: Train Loss: 1.4175, Val Loss: 1.0003, Val Acc: 71.50%
2025-11-21 22:34:12,008 - INFO - Epoch 3/3: LR: 0.000000
2025-11-21 22:34:12,010 - INFO - Epoch 3/3: Train Loss: 0.9360, Val Loss: 0.8710, Val Acc: 74.08%
2025-11-21 22:34:12,011 - INFO - Training completed!
2025-11-21 22:34:12,012 - INFO - Reference model training completed!
2025-11-21 22:34:12,014 - INFO - Generating training curves...
2025-11-21 22:34:13,954 - INFO - Training curves saved as separate images with base name 'runs/run_31/training_curves_reference'
2025-11-21 22:34:13,955 - INFO - Generating confusion matrix on test set...
2025-11-21 22:35:09,417 - INFO - Performing final evaluation of reference model on test set...
2025-11-21 22:35:53,336 - INFO - Final Test Results of reference model: Loss: 0.8728, Accuracy: 74.46%
2025-11-21 22:35:53,337 - INFO - Generating LR schedule plot of reference model...
2025-11-21 22:35:53,687 - INFO - LR schedule plot saved to 'runs/run_31/lr_schedule_reference.png'
2025-11-21 22:35:53,688 - INFO - 
Final Test Results:
2025-11-21 22:35:53,690 - INFO - Loss: 0.8728
2025-11-21 22:35:53,691 - INFO - Accuracy: 74.46%
2025-11-21 22:35:53,692 - INFO - Precision: 75.42%
2025-11-21 22:35:53,693 - INFO - Recall: 74.46%
2025-11-21 22:35:53,695 - INFO - F1 Score: 74.34%
2025-11-21 22:35:53,703 - INFO - Experiment completed. Results saved to runs/run_31/results_reference.json
2025-11-21 22:35:53,706 - INFO - Experiment completed. Metadata saved to runs/run_31/metadata_reference.json
2025-11-21 22:35:53,935 - INFO - ✅ Model weights saved: trained_models/CIFAR100_final_model_reference_weights.pth
2025-11-21 22:35:53,936 - INFO - Starting custom model training...
2025-11-21 22:35:53,938 - INFO - Starting training...
2025-11-21 22:38:03,202 - INFO - Epoch 1/3: LR: 0.000550
2025-11-21 22:38:03,204 - INFO - Epoch 1/3: Train Loss: 3.5693, Val Loss: 2.5353, Val Acc: 60.41%
2025-11-21 22:40:12,144 - INFO - Epoch 2/3: LR: 0.001000
2025-11-21 22:40:12,146 - INFO - Epoch 2/3: Train Loss: 1.4186, Val Loss: 0.9996, Val Acc: 71.27%
2025-11-21 22:42:20,977 - INFO - Epoch 3/3: LR: 0.000000
2025-11-21 22:42:20,979 - INFO - Epoch 3/3: Train Loss: 0.9446, Val Loss: 0.8635, Val Acc: 74.23%
2025-11-21 22:42:20,981 - INFO - Training completed!
2025-11-21 22:42:20,982 - INFO - Custom model training completed!
2025-11-21 22:42:20,984 - INFO - Generating training curves...
2025-11-21 22:42:22,890 - INFO - Training curves saved as separate images with base name 'runs/run_31/training_curves_custom'
2025-11-21 22:42:22,891 - INFO - Generating confusion matrix on test set...
2025-11-21 22:43:18,494 - INFO - Performing final evaluation of custom model on test set...
2025-11-21 22:44:02,631 - INFO - Final Test Results of custom model: Loss: 0.8579, Accuracy: 74.15%
2025-11-21 22:44:02,632 - INFO - Generating LR schedule plot of custom model...
2025-11-21 22:44:02,983 - INFO - LR schedule plot saved to 'runs/run_31/lr_schedule_custom.png'
2025-11-21 22:44:02,984 - INFO - 
Final Test Results:
2025-11-21 22:44:02,985 - INFO - Loss: 0.8579
2025-11-21 22:44:02,987 - INFO - Accuracy: 74.15%
2025-11-21 22:44:02,988 - INFO - Precision: 74.90%
2025-11-21 22:44:02,989 - INFO - Recall: 74.15%
2025-11-21 22:44:02,991 - INFO - F1 Score: 74.10%
2025-11-21 22:44:02,998 - INFO - Experiment completed. Results saved to runs/run_31/results_custom.json
2025-11-21 22:44:03,002 - INFO - Experiment completed. Metadata saved to runs/run_31/metadata_custom.json
2025-11-21 22:44:03,236 - INFO - ✅ Model weights saved: trained_models/CIFAR100_final_model_custom_weights.pth
2025-11-21 22:44:03,238 - INFO - === MODEL COMPARISON RESULTS (Linear Probing on CIFAR-100) ===
2025-11-21 22:44:03,238 - INFO - Reference (HF): 74.46%
2025-11-21 22:44:03,240 - INFO - Custom        : 74.15%
2025-11-21 22:44:03,241 - INFO - Difference    : 0.31% (custom - reference)
2025-11-21 22:44:03,242 - INFO - Linear probing experiment completed successfully!
