2025-11-21 22:49:38,633 - INFO - Logging initialized. Log file: runs/run_32/training.log
2025-11-21 22:49:38,634 - INFO - Experiment directory: runs/run_32
2025-11-21 22:49:38,828 - INFO - Setting random seeds for reproducibility (seed: 42)...
2025-11-21 22:49:38,850 - INFO - Random seeds set to 42 (deterministic=False)
2025-11-21 22:49:38,851 - INFO - Setting up device...
2025-11-21 22:49:38,852 - INFO - Using device: cuda
2025-11-21 22:49:38,852 - INFO - Using device: cuda
2025-11-21 22:49:38,853 - INFO - Training configuration: epochs=3, warmup=2, lr=0.001
2025-11-21 22:49:38,854 - INFO - Using pretrained model: swin_small_patch4_window7_224
2025-11-21 22:49:38,854 - INFO - Model architecture: Swin-Small
2025-11-21 22:49:38,855 - INFO - Model config: embed_dim=96, depths=[2, 2, 18, 2], num_heads=[3, 6, 12, 24]
2025-11-21 22:49:38,856 - INFO - Image size: 224x224, patch_size: 4x4
2025-11-21 22:49:38,857 - INFO - Loading dataset...
2025-11-21 22:49:42,356 - INFO - Dataset loaded: train=1303, val=261, test=313 batches
2025-11-21 22:49:42,357 - INFO - Initializing reference model...
2025-11-21 22:49:42,357 - INFO - Loading TIMM model: swin_small_patch4_window7_224 with pretrained weights
2025-11-21 22:49:44,506 - INFO - Loading pretrained weights from Hugging Face hub (timm/swin_small_patch4_window7_224.ms_in22k_ft_in1k)
2025-11-21 22:49:44,943 - INFO - HTTP Request: HEAD https://huggingface.co/timm/swin_small_patch4_window7_224.ms_in22k_ft_in1k/resolve/main/model.safetensors "HTTP/1.1 302 Found"
2025-11-21 22:49:45,269 - INFO - HTTP Request: GET https://huggingface.co/api/models/timm/swin_small_patch4_window7_224.ms_in22k_ft_in1k/xet-read-token/221ee757828e4772df860bd42ef476de78dd5fc6 "HTTP/1.1 200 OK"
2025-11-21 22:49:48,613 - INFO - [timm/swin_small_patch4_window7_224.ms_in22k_ft_in1k] Safe alternative available for 'pytorch_model.bin' (as 'model.safetensors'). Loading weights using safetensors.
2025-11-21 22:49:49,173 - INFO - Successfully loaded swin_small_patch4_window7_224 from TIMM
2025-11-21 22:49:49,174 - INFO - Encoder loaded: 768 output features
2025-11-21 22:49:49,176 - INFO - Created classification head: 768 -> 100 classes
2025-11-21 22:49:49,180 - INFO - Reference model created. Trainable params (head only): 78,436
2025-11-21 22:49:49,446 - INFO - Detected Swin Transformer architecture
2025-11-21 22:49:49,447 - INFO - Extracting model size from TIMM model name...
2025-11-21 22:49:49,448 - INFO - Detected model size: small
2025-11-21 22:49:49,449 - INFO - Will create custom model with: {'embed_dim': 96, 'depths': [2, 2, 18, 2], 'num_heads': [3, 6, 12, 24]}
2025-11-21 22:49:49,450 - INFO - Initializing custom Swin model (size: small)...
2025-11-21 22:49:49,450 - INFO - Custom model will match architecture: embed_dim=96, depths=[2, 2, 18, 2], num_heads=[3, 6, 12, 24]
2025-11-21 22:49:51,278 - INFO - Transferring weights from reference to custom encoder...
2025-11-21 22:49:51,279 - INFO - Weight transfer: SwinTransformer -> SwinTransformerModel
2025-11-21 22:49:51,342 - INFO - Weight transfer: 325 layers transferred.
2025-11-21 22:49:51,426 - INFO - Weight transfer completed: {'transferred': 325, 'missing': 0, 'size_mismatches': 0}
2025-11-21 22:49:51,427 - INFO - ✓ All expected weights transferred successfully
2025-11-21 22:49:51,431 - INFO - Custom model created. Trainable params (head only): 78,436
2025-11-21 22:49:51,442 - INFO - Starting reference model training...
2025-11-21 22:49:51,444 - INFO - Starting training...
2025-11-21 22:52:28,662 - INFO - Epoch 1/3: LR: 0.000550
2025-11-21 22:52:28,663 - INFO - Epoch 1/3: Train Loss: 3.1751, Val Loss: 1.8980, Val Acc: 75.99%
2025-11-21 22:55:02,752 - INFO - Epoch 2/3: LR: 0.001000
2025-11-21 22:55:02,753 - INFO - Epoch 2/3: Train Loss: 0.8874, Val Loss: 0.6343, Val Acc: 81.58%
2025-11-21 22:57:36,736 - INFO - Epoch 3/3: LR: 0.000000
2025-11-21 22:57:36,738 - INFO - Epoch 3/3: Train Loss: 0.5734, Val Loss: 0.5634, Val Acc: 83.33%
2025-11-21 22:57:36,738 - INFO - Training completed!
2025-11-21 22:57:36,739 - INFO - Reference model training completed!
2025-11-21 22:57:36,740 - INFO - Generating training curves...
2025-11-21 22:57:41,124 - INFO - Training curves saved as separate images with base name 'runs/run_32/training_curves_reference'
2025-11-21 22:57:41,125 - INFO - Generating confusion matrix on test set...
2025-11-21 22:59:06,471 - INFO - Performing final evaluation of reference model on test set...
2025-11-21 22:59:58,395 - INFO - Final Test Results of reference model: Loss: 0.5572, Accuracy: 83.66%
2025-11-21 22:59:58,396 - INFO - Generating LR schedule plot of reference model...
2025-11-21 22:59:59,188 - INFO - LR schedule plot saved to 'runs/run_32/lr_schedule_reference.png'
2025-11-21 22:59:59,189 - INFO - 
Final Test Results:
2025-11-21 22:59:59,191 - INFO - Loss: 0.5572
2025-11-21 22:59:59,192 - INFO - Accuracy: 83.66%
2025-11-21 22:59:59,192 - INFO - Precision: 84.39%
2025-11-21 22:59:59,193 - INFO - Recall: 83.66%
2025-11-21 22:59:59,194 - INFO - F1 Score: 83.64%
2025-11-21 22:59:59,212 - INFO - Experiment completed. Results saved to runs/run_32/results_reference.json
2025-11-21 22:59:59,216 - INFO - Experiment completed. Metadata saved to runs/run_32/metadata_reference.json
2025-11-21 22:59:59,936 - INFO - ✅ Model weights saved: trained_models/CIFAR100_final_model_reference_weights.pth
2025-11-21 22:59:59,937 - INFO - Starting custom model training...
2025-11-21 22:59:59,939 - INFO - Starting training...
2025-11-21 23:02:38,164 - INFO - Epoch 1/3: LR: 0.000550
2025-11-21 23:02:38,165 - INFO - Epoch 1/3: Train Loss: 3.1577, Val Loss: 1.8634, Val Acc: 76.22%
2025-11-21 23:05:16,365 - INFO - Epoch 2/3: LR: 0.001000
2025-11-21 23:05:16,366 - INFO - Epoch 2/3: Train Loss: 0.8846, Val Loss: 0.6176, Val Acc: 81.99%
2025-11-21 23:07:54,404 - INFO - Epoch 3/3: LR: 0.000000
2025-11-21 23:07:54,405 - INFO - Epoch 3/3: Train Loss: 0.5702, Val Loss: 0.5515, Val Acc: 83.46%
2025-11-21 23:07:54,406 - INFO - Training completed!
2025-11-21 23:07:54,407 - INFO - Custom model training completed!
2025-11-21 23:07:54,408 - INFO - Generating training curves...
2025-11-21 23:07:58,696 - INFO - Training curves saved as separate images with base name 'runs/run_32/training_curves_custom'
2025-11-21 23:07:58,696 - INFO - Generating confusion matrix on test set...
2025-11-21 23:09:24,480 - INFO - Performing final evaluation of custom model on test set...
2025-11-21 23:10:17,340 - INFO - Final Test Results of custom model: Loss: 0.5517, Accuracy: 83.31%
2025-11-21 23:10:17,341 - INFO - Generating LR schedule plot of custom model...
2025-11-21 23:10:18,088 - INFO - LR schedule plot saved to 'runs/run_32/lr_schedule_custom.png'
2025-11-21 23:10:18,088 - INFO - 
Final Test Results:
2025-11-21 23:10:18,089 - INFO - Loss: 0.5517
2025-11-21 23:10:18,090 - INFO - Accuracy: 83.31%
2025-11-21 23:10:18,091 - INFO - Precision: 84.04%
2025-11-21 23:10:18,092 - INFO - Recall: 83.31%
2025-11-21 23:10:18,093 - INFO - F1 Score: 83.19%
2025-11-21 23:10:18,111 - INFO - Experiment completed. Results saved to runs/run_32/results_custom.json
2025-11-21 23:10:18,115 - INFO - Experiment completed. Metadata saved to runs/run_32/metadata_custom.json
2025-11-21 23:10:18,803 - INFO - ✅ Model weights saved: trained_models/CIFAR100_final_model_custom_weights.pth
2025-11-21 23:10:18,805 - INFO - === MODEL COMPARISON RESULTS (Linear Probing on CIFAR-100) ===
2025-11-21 23:10:18,805 - INFO - Reference (HF): 83.66%
2025-11-21 23:10:18,806 - INFO - Custom        : 83.31%
2025-11-21 23:10:18,807 - INFO - Difference    : 0.35% (custom - reference)
2025-11-21 23:10:18,808 - INFO - Linear probing experiment completed successfully!
