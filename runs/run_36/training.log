2025-11-21 23:37:27,683 - INFO - Logging initialized. Log file: runs/run_36/training.log
2025-11-21 23:37:27,747 - INFO - Experiment directory: runs/run_36
2025-11-21 23:37:27,924 - INFO - Setting random seeds for reproducibility (seed: 42)...
2025-11-21 23:37:27,936 - INFO - Random seeds set to 42 (deterministic=False)
2025-11-21 23:37:27,937 - INFO - Setting up device...
2025-11-21 23:37:27,938 - INFO - Using device: cuda
2025-11-21 23:37:27,940 - INFO - Using device: cuda
2025-11-21 23:37:27,941 - INFO - Training configuration: epochs=3, warmup=2, lr=0.001
2025-11-21 23:37:27,942 - INFO - Using pretrained model: swin_large_patch4_window7_224
2025-11-21 23:37:27,943 - INFO - Model architecture: Swin-Large
2025-11-21 23:37:27,944 - INFO - Model config: embed_dim=192, depths=[2, 2, 18, 2], num_heads=[6, 12, 24, 48]
2025-11-21 23:37:27,945 - INFO - Image size: 224x224, patch_size: 4x4
2025-11-21 23:37:27,946 - INFO - Loading dataset...
2025-11-21 23:37:30,379 - INFO - Dataset loaded: train=1303, val=261, test=313 batches
2025-11-21 23:37:30,380 - INFO - Initializing reference model...
2025-11-21 23:37:30,381 - INFO - Loading TIMM model: swin_large_patch4_window7_224 with pretrained weights
2025-11-21 23:37:32,802 - INFO - Loading pretrained weights from Hugging Face hub (timm/swin_large_patch4_window7_224.ms_in22k_ft_in1k)
2025-11-21 23:37:33,057 - INFO - HTTP Request: HEAD https://huggingface.co/timm/swin_large_patch4_window7_224.ms_in22k_ft_in1k/resolve/main/model.safetensors "HTTP/1.1 302 Found"
2025-11-21 23:37:33,454 - INFO - HTTP Request: GET https://huggingface.co/api/models/timm/swin_large_patch4_window7_224.ms_in22k_ft_in1k/xet-read-token/e05e58ff5362edd212120dffaff3206a633c5534 "HTTP/1.1 200 OK"
2025-11-21 23:37:37,380 - INFO - [timm/swin_large_patch4_window7_224.ms_in22k_ft_in1k] Safe alternative available for 'pytorch_model.bin' (as 'model.safetensors'). Loading weights using safetensors.
2025-11-21 23:37:38,583 - INFO - Successfully loaded swin_large_patch4_window7_224 from TIMM
2025-11-21 23:37:38,584 - INFO - Encoder loaded: 1536 output features
2025-11-21 23:37:38,586 - INFO - Created classification head: 1536 -> 100 classes
2025-11-21 23:37:38,589 - INFO - Reference model created. Trainable params (head only): 156,772
2025-11-21 23:37:38,898 - INFO - Detected Swin Transformer architecture
2025-11-21 23:37:38,900 - INFO - Extracting model size from TIMM model name...
2025-11-21 23:37:38,902 - INFO - Detected model size: large
2025-11-21 23:37:38,903 - INFO - Will create custom model with: {'embed_dim': 192, 'depths': [2, 2, 18, 2], 'num_heads': [6, 12, 24, 48]}
2025-11-21 23:37:38,905 - INFO - Initializing custom Swin model (size: large)...
2025-11-21 23:37:38,907 - INFO - Custom model will match architecture: embed_dim=192, depths=[2, 2, 18, 2], num_heads=[6, 12, 24, 48]
2025-11-21 23:37:41,075 - INFO - Transferring weights from reference to custom encoder...
2025-11-21 23:37:41,077 - INFO - Weight transfer: SwinTransformer -> SwinTransformerModel
2025-11-21 23:37:41,146 - INFO - Weight transfer: 325 layers transferred.
2025-11-21 23:37:41,281 - INFO - Weight transfer completed: {'transferred': 325, 'missing': 0, 'size_mismatches': 0}
2025-11-21 23:37:41,282 - INFO - ✓ All expected weights transferred successfully
2025-11-21 23:37:41,285 - INFO - Custom model created. Trainable params (head only): 156,772
2025-11-21 23:37:41,289 - INFO - Starting reference model training...
2025-11-21 23:37:41,291 - INFO - Starting training...
2025-11-21 23:49:22,656 - INFO - Epoch 1/3: LR: 0.000550
2025-11-21 23:49:22,658 - INFO - Epoch 1/3: Train Loss: 2.3537, Val Loss: 0.9997, Val Acc: 84.26%
2025-11-22 00:01:02,773 - INFO - Epoch 2/3: LR: 0.001000
2025-11-22 00:01:02,775 - INFO - Epoch 2/3: Train Loss: 0.5551, Val Loss: 0.4424, Val Acc: 87.40%
2025-11-22 00:12:43,168 - INFO - Epoch 3/3: LR: 0.000000
2025-11-22 00:12:43,170 - INFO - Epoch 3/3: Train Loss: 0.3868, Val Loss: 0.4392, Val Acc: 87.35%
2025-11-22 00:12:43,172 - INFO - Training completed!
2025-11-22 00:12:43,173 - INFO - Reference model training completed!
2025-11-22 00:12:43,175 - INFO - Generating training curves...
2025-11-22 00:12:45,159 - INFO - Training curves saved as separate images with base name 'runs/run_36/training_curves_reference'
2025-11-22 00:12:45,161 - INFO - Generating confusion matrix on test set...
2025-11-22 00:16:56,240 - INFO - Performing final evaluation of reference model on test set...
2025-11-22 00:20:56,000 - INFO - Final Test Results of reference model: Loss: 0.4138, Accuracy: 87.71%
2025-11-22 00:20:56,001 - INFO - Generating LR schedule plot of reference model...
2025-11-22 00:20:56,359 - INFO - LR schedule plot saved to 'runs/run_36/lr_schedule_reference.png'
2025-11-22 00:20:56,361 - INFO - 
Final Test Results:
2025-11-22 00:20:56,362 - INFO - Loss: 0.4138
2025-11-22 00:20:56,364 - INFO - Accuracy: 87.71%
2025-11-22 00:20:56,365 - INFO - Precision: 88.15%
2025-11-22 00:20:56,367 - INFO - Recall: 87.71%
2025-11-22 00:20:56,368 - INFO - F1 Score: 87.64%
2025-11-22 00:20:56,376 - INFO - Experiment completed. Results saved to runs/run_36/results_reference.json
2025-11-22 00:20:56,380 - INFO - Experiment completed. Metadata saved to runs/run_36/metadata_reference.json
2025-11-22 00:20:57,919 - INFO - ✅ Model weights saved: trained_models/CIFAR100_final_model_reference_weights.pth
2025-11-22 00:20:57,920 - INFO - Starting custom model training...
2025-11-22 00:20:57,922 - INFO - Starting training...
2025-11-22 00:32:56,010 - INFO - Epoch 1/3: LR: 0.000550
2025-11-22 00:32:56,011 - INFO - Epoch 1/3: Train Loss: 2.3679, Val Loss: 0.9977, Val Acc: 84.28%
2025-11-22 00:45:03,151 - INFO - Epoch 2/3: LR: 0.001000
2025-11-22 00:45:03,153 - INFO - Epoch 2/3: Train Loss: 0.5597, Val Loss: 0.4450, Val Acc: 87.32%
2025-11-22 00:57:09,380 - INFO - Epoch 3/3: LR: 0.000000
2025-11-22 00:57:09,381 - INFO - Epoch 3/3: Train Loss: 0.3854, Val Loss: 0.4251, Val Acc: 87.57%
2025-11-22 00:57:09,383 - INFO - Training completed!
2025-11-22 00:57:09,385 - INFO - Custom model training completed!
2025-11-22 00:57:09,387 - INFO - Generating training curves...
2025-11-22 00:57:11,257 - INFO - Training curves saved as separate images with base name 'runs/run_36/training_curves_custom'
2025-11-22 00:57:11,259 - INFO - Generating confusion matrix on test set...
2025-11-22 01:01:30,431 - INFO - Performing final evaluation of custom model on test set...
2025-11-22 01:05:37,361 - INFO - Final Test Results of custom model: Loss: 0.4096, Accuracy: 87.80%
2025-11-22 01:05:37,363 - INFO - Generating LR schedule plot of custom model...
2025-11-22 01:05:37,727 - INFO - LR schedule plot saved to 'runs/run_36/lr_schedule_custom.png'
2025-11-22 01:05:37,728 - INFO - 
Final Test Results:
2025-11-22 01:05:37,730 - INFO - Loss: 0.4096
2025-11-22 01:05:37,731 - INFO - Accuracy: 87.80%
2025-11-22 01:05:37,732 - INFO - Precision: 88.62%
2025-11-22 01:05:37,734 - INFO - Recall: 87.80%
2025-11-22 01:05:37,735 - INFO - F1 Score: 87.82%
2025-11-22 01:05:37,742 - INFO - Experiment completed. Results saved to runs/run_36/results_custom.json
2025-11-22 01:05:37,745 - INFO - Experiment completed. Metadata saved to runs/run_36/metadata_custom.json
2025-11-22 01:05:39,320 - INFO - ✅ Model weights saved: trained_models/CIFAR100_final_model_custom_weights.pth
2025-11-22 01:05:39,322 - INFO - === MODEL COMPARISON RESULTS (Linear Probing on CIFAR-100) ===
2025-11-22 01:05:39,323 - INFO - Reference (HF): 87.71%
2025-11-22 01:05:39,324 - INFO - Custom        : 87.80%
2025-11-22 01:05:39,325 - INFO - Difference    : 0.09% (custom - reference)
2025-11-22 01:05:39,326 - INFO - Linear probing experiment completed successfully!
