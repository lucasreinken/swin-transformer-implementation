2025-11-22 11:07:50,006 - INFO - Logging initialized. Log file: runs/run_41/training.log
2025-11-22 11:07:50,007 - INFO - Experiment directory: runs/run_41
2025-11-22 11:07:50,207 - INFO - Setting random seeds for reproducibility (seed: 42)...
2025-11-22 11:07:50,219 - INFO - Random seeds set to 42 (deterministic=False)
2025-11-22 11:07:50,220 - INFO - Setting up device...
2025-11-22 11:07:50,221 - INFO - Using device: cuda
2025-11-22 11:07:50,221 - INFO - Using device: cuda
2025-11-22 11:07:50,222 - INFO - Training configuration: epochs=3, warmup=2, lr=0.001
2025-11-22 11:07:50,222 - INFO - Using pretrained model: swin_base_patch4_window7_224
2025-11-22 11:07:50,223 - INFO - Model architecture: Swin-Base
2025-11-22 11:07:50,224 - INFO - Model config: embed_dim=128, depths=[2, 2, 18, 2], num_heads=[4, 8, 16, 32]
2025-11-22 11:07:50,224 - INFO - Image size: 224x224, patch_size: 4x4
2025-11-22 11:07:50,225 - INFO - Loading dataset...
2025-11-22 11:07:52,637 - INFO - Dataset loaded: train=1303, val=261, test=313 batches
2025-11-22 11:07:52,638 - INFO - Initializing reference model...
2025-11-22 11:07:52,638 - INFO - Loading TIMM model: swin_base_patch4_window7_224 with pretrained weights
2025-11-22 11:07:53,889 - INFO - Loading pretrained weights from Hugging Face hub (timm/swin_base_patch4_window7_224.ms_in22k_ft_in1k)
2025-11-22 11:07:54,105 - INFO - HTTP Request: HEAD https://huggingface.co/timm/swin_base_patch4_window7_224.ms_in22k_ft_in1k/resolve/main/model.safetensors "HTTP/1.1 302 Found"
2025-11-22 11:07:54,136 - INFO - [timm/swin_base_patch4_window7_224.ms_in22k_ft_in1k] Safe alternative available for 'pytorch_model.bin' (as 'model.safetensors'). Loading weights using safetensors.
2025-11-22 11:07:54,624 - INFO - Successfully loaded swin_base_patch4_window7_224 from TIMM
2025-11-22 11:07:54,625 - INFO - Encoder loaded: 1024 output features
2025-11-22 11:07:54,627 - INFO - Created classification head: 1024 -> 100 classes
2025-11-22 11:07:54,629 - INFO - Reference model created. Trainable params (head only): 104,548
2025-11-22 11:07:54,886 - INFO - Detected Swin Transformer architecture
2025-11-22 11:07:54,887 - INFO - Extracting model size from TIMM model name...
2025-11-22 11:07:54,888 - INFO - Detected model size: base
2025-11-22 11:07:54,889 - INFO - Will create custom model with: {'embed_dim': 128, 'depths': [2, 2, 18, 2], 'num_heads': [4, 8, 16, 32]}
2025-11-22 11:07:54,890 - INFO - Initializing custom Swin model (size: base)...
2025-11-22 11:07:54,891 - INFO - Custom model will match architecture: embed_dim=128, depths=[2, 2, 18, 2], num_heads=[4, 8, 16, 32]
2025-11-22 11:07:55,952 - INFO - Transferring weights from reference to custom encoder...
2025-11-22 11:07:55,953 - INFO - Weight transfer: SwinTransformer -> SwinTransformerModel
2025-11-22 11:07:56,002 - INFO - Weight transfer: 325 layers transferred.
2025-11-22 11:07:56,067 - INFO - Weight transfer completed: {'transferred': 325, 'missing': 0, 'size_mismatches': 0}
2025-11-22 11:07:56,068 - INFO - ✓ All expected weights transferred successfully
2025-11-22 11:07:56,070 - INFO - Custom model created. Trainable params (head only): 104,548
2025-11-22 11:07:56,074 - INFO - Starting reference model training...
2025-11-22 11:07:56,076 - INFO - Starting training...
2025-11-22 11:14:01,360 - INFO - Epoch 1/3: LR: 0.000550
2025-11-22 11:14:01,361 - INFO - Epoch 1/3: Train Loss: 2.8799, Val Loss: 1.5045, Val Acc: 80.57%
2025-11-22 11:20:05,067 - INFO - Epoch 2/3: LR: 0.001000
2025-11-22 11:20:05,068 - INFO - Epoch 2/3: Train Loss: 0.7458, Val Loss: 0.5426, Val Acc: 84.17%
2025-11-22 11:26:08,773 - INFO - Epoch 3/3: LR: 0.000000
2025-11-22 11:26:08,774 - INFO - Epoch 3/3: Train Loss: 0.4973, Val Loss: 0.4933, Val Acc: 85.42%
2025-11-22 11:26:08,775 - INFO - Training completed!
2025-11-22 11:26:08,776 - INFO - Reference model training completed!
2025-11-22 11:26:08,777 - INFO - Generating training curves...
2025-11-22 11:26:10,649 - INFO - Training curves saved as separate images with base name 'runs/run_41/training_curves_reference'
2025-11-22 11:26:10,650 - INFO - Generating confusion matrix on test set...
2025-11-22 11:28:27,636 - INFO - Performing final evaluation of reference model on test set...
2025-11-22 11:30:32,255 - INFO - Final Test Results of reference model: Loss: 0.4795, Accuracy: 85.82%
2025-11-22 11:30:32,256 - INFO - Generating LR schedule plot of reference model...
2025-11-22 11:30:32,603 - INFO - LR schedule plot saved to 'runs/run_41/lr_schedule_reference.png'
2025-11-22 11:30:32,605 - INFO - 
Final Test Results:
2025-11-22 11:30:32,606 - INFO - Loss: 0.4795
2025-11-22 11:30:32,607 - INFO - Accuracy: 85.82%
2025-11-22 11:30:32,608 - INFO - Precision: 86.25%
2025-11-22 11:30:32,609 - INFO - Recall: 85.82%
2025-11-22 11:30:32,609 - INFO - F1 Score: 85.77%
2025-11-22 11:30:32,616 - INFO - Experiment completed. Results saved to runs/run_41/results_reference.json
2025-11-22 11:30:32,620 - INFO - Experiment completed. Metadata saved to runs/run_41/metadata_reference.json
2025-11-22 11:30:33,391 - INFO - ✅ Model weights saved: trained_models/CIFAR100_final_model_reference_weights.pth
2025-11-22 11:30:33,392 - INFO - Starting custom model training...
2025-11-22 11:30:33,393 - INFO - Starting training...
2025-11-22 11:36:39,033 - INFO - Epoch 1/3: LR: 0.000550
2025-11-22 11:36:39,034 - INFO - Epoch 1/3: Train Loss: 2.9112, Val Loss: 1.5104, Val Acc: 80.84%
2025-11-22 11:42:45,258 - INFO - Epoch 2/3: LR: 0.001000
2025-11-22 11:42:45,259 - INFO - Epoch 2/3: Train Loss: 0.7506, Val Loss: 0.5315, Val Acc: 84.96%
2025-11-22 11:48:50,855 - INFO - Epoch 3/3: LR: 0.000000
2025-11-22 11:48:50,856 - INFO - Epoch 3/3: Train Loss: 0.4915, Val Loss: 0.4779, Val Acc: 85.46%
2025-11-22 11:48:50,857 - INFO - Training completed!
2025-11-22 11:48:50,858 - INFO - Custom model training completed!
2025-11-22 11:48:50,859 - INFO - Generating training curves...
2025-11-22 11:48:52,868 - INFO - Training curves saved as separate images with base name 'runs/run_41/training_curves_custom'
2025-11-22 11:48:52,869 - INFO - Generating confusion matrix on test set...
2025-11-22 11:51:09,302 - INFO - Performing final evaluation of custom model on test set...
2025-11-22 11:53:14,133 - INFO - Final Test Results of custom model: Loss: 0.4786, Accuracy: 85.66%
2025-11-22 11:53:14,134 - INFO - Generating LR schedule plot of custom model...
2025-11-22 11:53:14,479 - INFO - LR schedule plot saved to 'runs/run_41/lr_schedule_custom.png'
2025-11-22 11:53:14,480 - INFO - 
Final Test Results:
2025-11-22 11:53:14,481 - INFO - Loss: 0.4786
2025-11-22 11:53:14,482 - INFO - Accuracy: 85.66%
2025-11-22 11:53:14,483 - INFO - Precision: 86.23%
2025-11-22 11:53:14,483 - INFO - Recall: 85.66%
2025-11-22 11:53:14,485 - INFO - F1 Score: 85.64%
2025-11-22 11:53:14,491 - INFO - Experiment completed. Results saved to runs/run_41/results_custom.json
2025-11-22 11:53:14,494 - INFO - Experiment completed. Metadata saved to runs/run_41/metadata_custom.json
2025-11-22 11:53:15,256 - INFO - ✅ Model weights saved: trained_models/CIFAR100_final_model_custom_weights.pth
2025-11-22 11:53:15,257 - INFO - === MODEL COMPARISON RESULTS (Linear Probing on CIFAR-100) ===
2025-11-22 11:53:15,258 - INFO - Reference (HF): 85.82%
2025-11-22 11:53:15,258 - INFO - Custom        : 85.66%
2025-11-22 11:53:15,259 - INFO - Difference    : 0.16% (custom - reference)
2025-11-22 11:53:15,260 - INFO - Linear probing experiment completed successfully!
